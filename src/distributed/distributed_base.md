
### 分布式寻址算法

* hash 算法
* 一致性 hash 算法
* redis cluster 的 hash slot 算法

#### hash 算法

__原先__，通过一个 key 计算对应的 hash 值，然后对节点数 num 取模，打在指定的 master 节点上。 __当__ 某个master 宕机时，
所有的请求都会基于最新的剩余 master 节点数 num(num - 1) 进行取模，导致取数据时失败。

#### 一致性 hash 算法

一致性 hash 算法将整个 hash 值空间组织成一个虚拟的圆环，整个空间按照 __顺时针__ 方向分布，然后将所有的 master 节点（ip/port）
进行 hash 对应，当查找 key 时，计算 hash 值确定在圆环上的位置，然后按照 __顺时针__ 的顺序找到遇到的第一个 master 节点。

在一致性 hash 算法中，如果一个节点挂了，受到影响的数据仅仅是次节点到环空间前的一个节点（逆时针的第一个节点）之间的数据，其它不受影响。

但一致性 hash 算法在节点太少时，容易因为节点分布不均匀从而造成 __缓存热点__ 的问题（因为节点分布不均匀，某个节点的数据区间大，大量请求
将打在这个节点上），为了解决这种问题，引进 __虚拟节点__ 机制，即对每个节点计算多个 hash，每个计算结果都放置一个虚拟节点。这样实现了数据
的均匀分布，负载均衡。

![](/img/consistent-hashing-algorithm.png)
