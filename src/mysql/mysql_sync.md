
### Mysql 主从复制原理

主库将变更内容写入 __binlog__，然后通过 io 线程传递给从库，从库的 io 线程负责接收 binlog 并拷贝到本地，然后写入到
relay 中继日志中，接着从库的 sql 线程会从中继日志读取 binlog，然后执行 binlog 中的内容，即本地执行 sql，最终使
主从双方的数据一致。


__注意__： 由于从库从主库拷贝日志以及串行执行 sql 特点，在高并发场景下，从库的数据一定会比主库慢一些，存在 __延时__ 性，
同时还存在着另一个问题，如果主库突然宕机，然后恰好数据还没同步到从库，那么有些数据可能在从库是没有的，那么这些数据就 __丢失__ 了。

#### 解决办法

* 并行复制

指的是从库开启多个线程(sql thread)，并行读取 relay log 中不同库的日志，然后并行重放不同库的日志，这是库级别的并行。
并行复制的难点在于多线程恢复数据时如何避免锁冲突。

* 半同步复制

指的是主库写入 binlog 之后，就会强制立即将数据同步到从库，从库将日志写入自己本地的 relay log 之后，接着会返回一个 ack 给主库，
主库接收到至少一个从库的 ack 之后才会认为写操作完成了。




